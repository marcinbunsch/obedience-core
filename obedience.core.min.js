var Obedience={};Obedience.Behavior=function(c,d){this.name=c;this.callback=d;this.everywhere=function(){Obedience.Router.map('*',this);return this};this.on=function(){var b=this;Obedience.Core.each(arguments,function(a){Obedience.Router.map(a,b)});return this};this.except=function(){var b=this;Obedience.Core.each(arguments,function(a){Obedience.Router.exception(a,b)});return this}};Obedience.Behavior.collection={};Obedience.Behavior.behavior=function(a,b){if(!b)return Obedience.Behavior.collection[a];var c=new Obedience.Behavior(a,b);if(Obedience.Behavior.collection[a])throw'The Behavior name \''+a+'\' is reserved. Please choose a different name';Obedience.Behavior.collection[a]=c};Obedience.Core={each:function(a,b){for(var c=0,d=a.length;c<d;c++)b(a[c])}};Obedience.Debug=function(b){return{status:'off',on:function(){this.status='on'},off:function(){this.status='off'},info:function(a){if(this.status=='on'&&b.console&&console.info)console.info.apply(console,[a])}}}(this);Obedience.Hook={collection:{},insert:function(a,b){var c=this;if(!a)return;if(!c.collection[a])c.collection[a]=[];if(!b)return;c.collection[a].push(b);Obedience.Debug.info("Added Hook: "+(b.name||'an anonymous callback')+' to '+a);return b},invoke:function(a){var b=this;if(!b.collection[a])return;Obedience.Debug.info("Invoking Hook: "+a);for(var c=0;c<b.collection[a].length;c++){if(b.collection[a][c].callback&&b.collection[a][c].callback.constructor==Function){Obedience.Debug.info("Running Behavior "+b.collection[a][c].name);b.collection[a][c].callback()}else if(b.collection[a][c].constructor==Function){b.collection[a][c]()}}return true}};Obedience.Resource=function(h){var o=h.url;var m=h.url.split('/');var n=m[m.length-1].replace(/s$/,'');var k={};var j=function(f){try{var g=jQuery.parseJSON(f.responseText);var i=[];jQuery.each(g,function(c,d){jQuery.each(d[n],function(a,b){i.push(b.error.description)})});return i}catch(e){return[]}};this.url=h.url;this.extract_errors=j;this.scopes={};this.scope=function(c){var d=jQuery.param(c);if(this.scopes[d])return this.scopes[d];cloned_options={};jQuery.each(h,function(a,b){cloned_options[a]=b});jQuery.each(c,function(a,b){cloned_options.url=cloned_options.url.replace(new RegExp(':'+a),b)});this.scopes[d]=new Resource(cloned_options);return this.scopes[d]};this.cache=function(a,b){if(b)k[a]=b;return k[a]};this.cacheCollection=function(c){var d=this;jQuery.each(c,function(a,b){d.cache(b[n].id,b)})};this.getCacheCollection=function(){return k};this.all=function(d,f,g,i){if(typeof d=='function'){i=g;g=f;f=d;d=null};d=d||{};d['authenticity_token']=jQuery('meta[name="csrf-token"]').attr('content');var l=this;jQuery.ajax({type:'GET',url:h.url+'.json',data:d,success:function(c){f(c);if(jQuery.isArray(c)){jQuery.each(c,function(a,b){for(key in b)l.cache(b[key].id,b)})}},complete:g,error:i,dataType:'json'})};this.get=function(a,b,c){if(typeof a=='function'){c=b;b=a;a=null}a=a||{};a['authenticity_token']=jQuery('meta[name="csrf-token"]').attr('content');jQuery.ajax({type:'GET',url:h.url+'.json',data:a,success:b,complete:c,dataType:'json'})};this.find=function(a,b,c){if(cached=this.cache(a))return cached;var d={'authenticity_token':jQuery('meta[name="csrf-token"]').attr('content')};jQuery.ajax({type:'GET',url:h.url+'/'+a+'.json',data:d,success:b,complete:c,dataType:'json'})};this.destroy=function(b,c,d,f){var g={'_method':'delete','authenticity_token':jQuery('meta[name="csrf-token"]').attr('content')};jQuery.ajax({type:'POST',url:h.url+'/'+b+'.json',data:g,success:c,complete:d,error:function(a){if(f)f(j(a),a)},dataType:'json'})};this.create=function(b,c,d,f){var g=this;b=b||{};if(typeof(b)=='string'){b=b+'&authenticity_token='+jQuery('meta[name="csrf-token"]').attr('content')}else{b['authenticity_token']=jQuery('meta[name="csrf-token"]').attr('content')};jQuery.ajax({type:'POST',url:h.url+'.json',data:b,success:function(a){for(key in a)if(a[key].id){g.cache(a[key].id,a);break};if(c)c(a)},complete:f,error:function(a){if(d)d(j(a),a)},dataType:'json'})};this.update=function(b,c,d,f,g){var i=this;c=c||{};if(typeof(c)=='string'){c=c+'&authenticity_token='+jQuery('meta[name="csrf-token"]').attr('content');c=c+'&_method=put'}else{c['authenticity_token']=jQuery('meta[name="csrf-token"]').attr('content');c['_method']='put'}jQuery.ajax({type:'POST',url:(b?(h.url+'/'+b+'.json'):h.url+'.json'),data:c,success:function(a){i.cache(b,a);if(d)d(a)},complete:g,error:function(a){if(f)f(j(a),a)},dataType:'json'})}};Obedience.Router={routes:{common:[],string:[],regex:[]},exceptions:{},_path:null,ran:false,path:function(){return Obedience.Router._path},run:function(){var a=window.location.href;var b=a.match(/https*:\/\/[^\/]*(\/)*([^?#$]*)/);var c=b[2];c=c.replace(/\/$/,'');this._path=c;this.invoke(c)},invoke:function(a){if(this.ran)return;this.ran=true;this.loop(this.routes.common,a,true);this.loop(this.routes.string,a);this.loop(this.routes.regex,a)},loop:function(a,b,c){for(var d=0;d<a.length;d++){var f=a[d];var g=false;if(this.exceptions[f.behavior.name]){for(var i=0;i<this.exceptions[f.behavior.name].length;i++){var l=this.exceptions[f.behavior.name][i];if(b.match(l.pattern))g=true}};if(!g){if(c){this.call(f.behavior,b);continue};if(f.pattern.constructor==String&&b==f.pattern){this.call(f.behavior,b)}else if(f.pattern.constructor==RegExp&&b.match(f.pattern)){this.call(f.behavior,b)}}}},call:function(a,b){Obedience.Debug.info("Running behavior: "+a.name);Obedience.Hook.invoke(a.name+'.beforeInit');a.callback(b);Obedience.Hook.invoke(a.name+'.afterInit')},map:function(a,b){if(a=='/')a='';if(a.constructor==String&&a=='*'){this.routes.common.push({pattern:a,behavior:b})}else if(a.constructor==String&&a.match(/:id/)){a=new RegExp(a.replace(/:id/,'[a-zA-Z0-9]+'));this.routes.regex.push({pattern:a,behavior:b})}else if(a.constructor==String&&a.match(/:num/)){a=new RegExp(a.replace(/:num/,'[0-9]+'));this.routes.regex.push({pattern:a,behavior:b})}else if(a.constructor==String&&a.match(/:string/)){a=new RegExp(a.replace(/:string/,'[a-zA-Z]+'));this.routes.regex.push({pattern:a,behavior:b})}else if(a.constructor==String&&a.match(/\*/)){a=new RegExp(a.replace(/\*/,'[a-zA-Z0-9\-]+'));this.routes.regex.push({pattern:a,behavior:b})}else if(a.constructor==RegExp){this.routes.regex.push({pattern:a,behavior:b})}else{this.routes.string.push({pattern:a,behavior:b})}},exception:function(a,b){if(a=='/')a='';if(!this.exceptions[b.name])this.exceptions[b.name]=[];if(a.constructor==String&&a==''){a=new RegExp('^'+a+'$')}else if(a.constructor==String&&a.match(/:id/)){a=new RegExp(a.replace(/:id/,'[a-zA-Z0-9]+'))}else if(a.constructor==String&&a.match(/:num/)){a=new RegExp(a.replace(/:num/,'[0-9]+'))}else if(a.constructor==String&&a.match(/:string/)){a=new RegExp(a.replace(/:string/,'[a-zA-Z]+'))}else if(a.constructor==String&&a.match(/\*/)){a=new RegExp(a.replace(/\*/,'[a-zA-Z0-9\-]+'))}else if(a.constructor==RegExp){}else{a=new RegExp(a)}this.exceptions[b.name].push({pattern:a,behavior:b})}};if(typeof(jQuery)!='undefined'){jQuery(Obedience.Router.run)}else if(typeof(Prototype)!='undefined'){Event.observe($(window),'load',Obedience.Router.run)}else if(typeof(window)!='undefined'){window.onload=Obedience.Router.run}